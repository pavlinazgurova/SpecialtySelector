namespace SpecialtySelector.Migrations
{
    using Microsoft.AspNet.Identity;
    using Microsoft.AspNet.Identity.EntityFramework;
    using SpecialtySelector.Data;
    using System;
    using System.Data.Entity;
    using System.Data.Entity.Migrations;
    using System.Linq;

    internal sealed class Configuration : DbMigrationsConfiguration<SpecialtySelector.Data.SpecialtySelectorDbContext>
    {
        public Configuration()
        {
            AutomaticMigrationsEnabled = true;
            AutomaticMigrationDataLossAllowed = false;
        }

        protected override void Seed(SpecialtySelectorDbContext context)
        {
            if (!context.Users.Any())
            {
                CreateUser(context, "Admin@gmail.com", "Admin@gmail.com");
            }
            if (!context.Departments.Any())
            {
                SeedDepartments(context);
            }
            if (!context.SubDepartments.Any())
            {
                context.SubDepartments.Add(new SubDepartment()
                {
                    Name = "?????????, ???????? ? ??????? ???????",
                    Description = @"?????????? ?? ???? ???????????? ?? ??????????? ? ????????????????? ???????? ?? ?????? ??????? ? ????????? ???????? ? ???????????? ?? ???????????, ????????, ????????? ? ?????????????, ????? ??????? ?? ?????????? ? ??????? ?? ?????????? ?????????? (????????????, ?????????????? ???????, ?????? ?? ??????????? ? ?????? ??????), ? ??????????? ?? ??????? ??????, ????????????? ? ??????????????? ???????????, ????????????????? ??????. ???????????? ?????? ?? ????????? ??????? 73 ?????????????, ?? ????? 16 ?????????, 28 ???????, 18 ?????? ????????? ? 11 ?????????.?????????? ?? ???????? ?? ?????????? ?????? ??????? ? ????????, ????? ???????????? ?? ???????? ? ???????? ? ????????????? ?? ?????????? ? ?? ???????????, ????????? ? ???????????? ????????????? ????????????. ?? ?????????? ?????????????, ?????????????? ? ?????????????? ?????????? ?? ???????????? ?? ?????????????? ?? ?????????????? ?????????,???????? ? ??????? ???????. ? ????? ? ????? ???? ?? ?????? ???????? ?? ???????????????? ?? ????????? ???????????? ? ????????? ?????????? ?? ?????????????????? ???? ?? ??????????? ?????????. ? ????? ???? ?? ???????? ?????????? ???????????? ? ????????? ??????????, ? ? ???????? – ?????????? ?? ????????? ???????????. ? ??????? ?? ??????????? ?? ???????? ?????????? ????????????? ??????????, ???? ????? ???????????? ?????????? ??????, ?????? ? ???????????, ????? ?? ???????????? ?? ??????? ????????????? ?????????? ?? ?????????? ? ?? ??????????? ?????? ?????.",
                    DepartmentId = 1
                });
                context.SubDepartments.Add(new SubDepartment()
                {
                    Name = "????????? ? ??????",
                    Description = @"??????????? ??? ?????????? ?? ??????? ? ??????-?????? ?????????, ????????????? ????????? ???-???????? ?????????? ?? ???????????? ?????????-?????????? ??????????? ?? ?????? ??????? ? ??????,?????????, ???????????? ? ??????? ?? ??????? ? ???-????, ?????????? ?? ??????????, ??????? ??????? ?????????? ? ???????? ?? ???????? ?????????.? ????? ???? ?? ???????? ???????????? ? ??-??????? ?????????? ?????? ??????????: ""????????????????"", ""???????? ? ???????"", ""???????????? ????????? ???????"", ""??????????? ?? ???????"",""???????????? ???? ??????????"", ""???????????????????????"", ""?????????? ?? ??????????"", ""???????????"", ""???????????? ?? ?????? ?????????????"", ""???????? ???????????"", ""????????????"", ""?????????????? ?????-??"", ""?????? ?????????"", ""?????? ????????????????"", ""??????? ????????? ? ???????????? ???????????"" ? ??.",
                    DepartmentId = 1
                });
                context.SubDepartments.Add(new SubDepartment()
                {
                    Name = "????????? ? ??????????????",
                    Description = @"???????? ???????? ? ??????????? ?? ??????????? ""?????????"", ""?????????-???????????"", ""?????????????? ? ??????"". ?? 31.05.1995 ?. ? ??????? ?? ??????????? ????? ? ??????????? ?? ???????? ""????????? ?? ????????????????"" ???? ????????????? ????? ??? ????. ? ???? ?? ???? ???????????? ?? ???????? ???????? ? ????????????, ??????????? ?????? ? ??????????.????????? ??????? ?? ????????? ? ?????????? ? ????????????, ???????????, ????????? ???????? ? ???????????? ?? ??????????? ?? ??????????? ? ?????????? ?? ??????????, ???????? ? ?????????? ?? ????????????????, ??????????? ?? ????????????????? ??????? ? ?????????? ?????????????.?????????? ???????? ??????????? ? ????????? ?? ???-?????????? ?????????? ?? ?????? ?? ??????????? ????????? – ?????????????????, ?????? ?? ???????? ??????????????? ???? ?? ?????????? ?????????? ? ???????????? ?? ?????????????.",
                    DepartmentId = 1
                });
                context.SubDepartments.Add(new SubDepartment()
                {
                    Name = "????????? ? ???????????? ????????",
                    Description = @"?????????? ?? ??????????? ""???????????????????????? ?????????"" ??? ?? ???? ??????? ??????????????????? ?????????? ?? ?????????????????? ??????????? ???????????????? ? ?????????????????, ????? ? ??? ?????? ? ?????? ? ?????????????????? ?? ?????????????? ???????????? ??????-??? ? ??????????, ???????????? ???????????? ??-????????, ?????????????? ???????, ???????????????????, ??????? ?????????????? ? ?????????.",
                    DepartmentId = 1
                });
                context.SubDepartments.Add(new SubDepartment()
                {
                    Name = "???????????? ?????????",
                    Description = @"???????? ???? ?? ????????????? ???????? 30-????????? ???????? ??????????????? ? ????????????? ? ???? ? ???? ?????? ? ?????? ????? ?????????? ???????????? ? ???????. ?????????? ????????? ??????????? ???-??????? ?? ??????? ? ?????? ?? ?????????????? ????????? ? ????????????????, ?????? ? ??????? ?? ??????, ???????? ???????? ?? ???????? ? ????????? ????????? ? ?????????????? ????????, ?????????? ? ?????????????????????, ???????????? ??????????, ?????????. ?????? ?????????? ? ????-???????? ?? ????? ????? ?????????? ?? ??? ????? ?????. ",
                    DepartmentId = 2
                });
            }
        }

        private static void SeedDepartments(SpecialtySelectorDbContext context)
        {
            context.Departments.Add(new Department()
            {
                Name = "?????????",
                Description = @"??????????? ?? ?????? ?? ?????????????? ??????? ?? ?????? ?????? ??? ????????? ??????, ?????????, ???????????? ? ??????? ???????, ?????????????? ??????, ????? ???????? ???????? ? ??????????????, ????????, ????????????? ? ????????????? ?? ????? ? ?????? ? ???? ?????? ??? ??????. ?????? ????????? ? ???????? ???????? ?? ????????, ????? ??????? ?????????? ????????, ??????? [1] ? ???????? ???????????, ????? ? ??????? ?????????, ?????????? ??????? ? ????????, ???? ??????? ???????. ???? ??????? ????????? ?????????, ???????????? ? ???????????? ?? ??????? ? ?????????, ??? ????? ??????????? ???????????. ??????????? ? ?????????? ???? ?? ????????? ? ???????????? ?? ??????????, ?????????? ?? ?????? ???? ?? ???? ?????????? ?? ?????? ??????"
            });
            context.Departments.Add(new Department()
            {
                Name = "??????????? ?????",
                Description = @"? ?????????????? ?? ???? ????????????? ??????????? ???????????? ????? ? ????? ???? ???????? ?????????????? ?????? ??????????:???????????? ?????? ??????????: ""????????? ? ?????????????"", ""?????-???? ? ???????? ??????"", ""??????????? ??????? ?? ?????? ? ??? ?? ?????-?? ???????? ?????"", ""??????? ?? ????????????? ????"", ""?????????"", ""??-???????? ??????????? ?????? ? ????????"", ""???? ??? ???????? ????????"",""??????????? ??????? ?? ???????? ????"", ""???????????"", ""??????????? ???-3??????"", ""?????????????? ?????"", ""?????????? ??????????"", ""?????????????????? ?? ?????????"", ""?????????? ??????????? ???????"", ""?????? ????-???? ?? ????????"", ""??????????? ? ???????? ?? ???????????? ??????"", ""??-???? ?? ????????????"", ???? ????, ""?????????? ? ?????"".????????? ?????? ??????????: ""????????????? ??????? ? ??????????"",""??????????"", ""??????????"", ""??????????? ??????????"", ""???????? ???????"",""????????????? ??????????? ? ??????"", ""???????????? ???????? ?????"",""??????????????? ?????"" ? ??"
            });
        }

        private void CreateUser(SpecialtySelectorDbContext context,
            string email,
            string password
        )
        {
            var userManager = new UserManager<User>(new UserStore<User>(context))
            {
                PasswordValidator = new PasswordValidator
                {
                    RequiredLength = 1,
                    RequireNonLetterOrDigit = false,
                    RequireDigit = false,
                    RequireLowercase = false,
                    RequireUppercase = false,
                }
            };
            var user = new User
            {
                UserName = email,
                Email = email,
            };
            var userCreateResult = userManager.Create(user, password);
            if (!userCreateResult.Succeeded)
            {
                throw new Exception(string.Join("; ", userCreateResult.Errors));
            }
        }
    }
}
